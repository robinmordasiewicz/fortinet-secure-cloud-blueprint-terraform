name: Branch Action
on:
  - delete
  - create
jobs:
  action:
    if: github.event.ref_type == 'branch'
    runs-on: ubuntu-latest
    steps:
      - name: Branch Action
        env:
          GITHUB_TOKEN:  ${{ secrets.CONTROLLER_TOKEN }}
        run: |
          if [[ ! -z "${{ secrets.CONTROLLER_REPOSITORY_FULL_NAME }}" ]]
          then
            APPLICATION_REPOSITORY_FULL_NAME_BASE64=$( echo ${{ github.repository }} | base64 | tr -d '\n\r' )
            gh workflow run environment-authorization.yml -R "${{ secrets.CONTROLLER_REPOSITORY_FULL_NAME }}" -f "application=${APPLICATION_REPOSITORY_FULL_NAME_BASE64}"
            fi
